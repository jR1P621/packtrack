<div class="panel panel-default templatemo-content-widget white-bg no-padding templatemo-overflow-hidden col-lg-6">
    <div class="{{color}}-bg white-text panel-body templatemo-position-relative">
        <h2 class="text-uppercase text-center">{{title}}</h2>
    </div>
    <input class='form-control' type="text" id="tableInput" onkeyup="tableFunction()" placeholder="Search invite codes">
    <div class="table-responsive">
        <table id='filterTable' class="table table-striped table-bordered">
            <thead>
                <tr class="header">
                    <th class='col-md-1'>Code</th>
                    <th class='col-md-1'>Expiration</th>
                    <th class='col-md-1'>Invitee</th>
                </tr>
            </thead>
            <tbody>
                {% for invite in invites %}
                {% if not invite.invite_receiver%}
                <tr>
                    <td>{{ invite.invite_code }}</td>
                    <td>{{ invite.invite_expiration }}</td>
                    <td>{% if invite.invite_receiver %}
                        <a href="/members/{{invite.invite_receiver.member_user_account.username}}">
                            {{ invite.invite_receiver.member_hash_name }}</a>
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
                {% for invite in invites %}
                {% if invite.invite_receiver%}
                <tr>
                    <td>{{ invite.invite_code }}</td>
                    <td>{{ invite.invite_expiration }}</td>
                    <td>{% if invite.invite_receiver %}
                        <a href="/members/{{invite.invite_receiver.member_user_account.username}}">
                            {{ invite.invite_receiver.member_hash_name }}</a>
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class='btn-group-xs'>
        <button class='templatemo-blue-button btn-block' id='create_invite' onClick='create_invite()'>
            Generate New Invite
        </button>
    </div>
</div>
{% include 'helpers/search_table_js.html' %}
<script>
    /*
    On submiting the form, send the POST ajax
    request to server and after successfull submission
    display the object.
    */
    function create_invite() {
        // make POST ajax call
        $.ajax({
            type: 'POST',
            url: "{% url 'post_invite' %}",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (response) {
                // on successfull creating object
                // display the newly friend to table.
                var instance = JSON.parse(response["instance"])[0];
                var fields = instance["fields"]
                $("#filterTable tbody").prepend(
                    `<tr>
        <td>${fields["invite_code"]||""}</td>
        <td>${fields["invite_expiration"]||""}</td>
        <td></td>
    </tr>`
                )
            },
            error: function (response) {
                // alert the error if any error occured
                alert(response["responseJSON"]["error"]);
            }
        })
    }

</script>
